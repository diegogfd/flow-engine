{
    "operation_type":"CHARGE",
    "steps":[
        {
            "id":"SET_AMOUNT",
            "required_fields":[
                "AMOUNT"
            ],
            "optional_fields":[
                "CART",
                "DESCRIPTION"
            ],
            "rules":null
        },
        {
            "id":"SET_BUYER_EMAIL",
            "required_fields":[
                "BUYER_EMAIL"
            ],
            "optional_fields":null,
            "rules":{
                "id":"EQUALS",
                "value":{
                    "field_id":"IS_RESERVATION",
                    "type":"bool",
                    "value":true
                }
            }
        },
        {
            "id":"SET_CHARGE_METHOD",
            "required_fields":[
                "CHARGE_METHOD"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"SET_CARD_TYPE",
            "required_fields":[
                "CARD_TYPE"
            ],
            "optional_fields":[
                "INSTALLMENTS"
            ],
            "rules":null
        },
        {
            "id":"SET_INSTALLMENTS",
            "required_fields":[
                "INSTALLMENTS"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"PAIRING",
            "required_fields":[
                "POI",
                "POI_TYPE"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"GET_WORKING_KEY",
            "required_fields":[
                "WORKING_KEY"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"READ_CARD",
            "required_fields":[
                "CARD_DATA"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"TOKENIZE_CARD",
            "required_fields":[
                "CARD_TOKEN",
                "PAYMENT_METHOD"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"SET_CVV",
            "required_fields":[
                "CVV"
            ],
            "optional_fields":null,
            "rules":{
                "id":"OR",
                "value":[
                    {
                        "id":"EQUALS",
                        "value":{
                            "field_id":"CARD_DATA_ENTRY_MODE",
                            "type":"string",
                            "value":"SWIPE"
                        }
                    },
                    {
                        "id":"EQUALS",
                        "value":{
                            "field_id":"ON_SITE_ALLOWED",
                            "type":"bool",
                            "value":true
                        }
                    }
                ]
            }
        },
        {
            "id":"DO_PAYMENT",
            "required_fields":[
                "CVV",
                "PAYMENT"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"EMV_FINISH_TRANSACTION",
            "required_fields":[
                "SENT_ADVICE",
                "WAS_REVERSED"
            ],
            "optional_fields":null,
            "rules":{
                "id":"AND",
                "value":[
                    {
                        "id":"EQUALS",
                        "value":{
                            "field_id":"CARD_DATA_ENTRY_MODE",
                            "type":"string",
                            "value":"CHIP"
                        }
                    },
                    {
                        "id":"EQUALS",
                        "value":{
                            "field_id":"ON_SITE_ALLOWED",
                            "type":"bool",
                            "value":false
                        }
                    }
                ]
            }
        },
        {
            "id":"SIGN",
            "required_fields":[
                "SIGNATURE"
            ],
            "optional_fields":null,
            "rules":{
                "id":"AND",
                "value":[
                    {
                        "id":"EQUALS",
                        "value":{
                            "field_id":"SIGNATURE_REQUIRED",
                            "type":"bool",
                            "value":true
                        }
                    },
                    {
                        "id":"EQUALS",
                        "value":{
                            "field_id":"PAYMENT_STATUS",
                            "type":"string",
                            "value":"approved"
                        }
                    }
                ]
            }
        },
        {
            "id":"POST_NOTIFICATION",
            "required_fields":[
                "NOTIFICATION"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"CONGRATS",
            "required_fields":[
                "SHOWED_PAYMENT_RESULT"
            ],
            "optional_fields":null,
            "rules":{
                "id":"EQUALS",
                "value":{
                    "field_id":"PAYMENT_STATUS",
                    "type":"string",
                    "value":"approved"
                }
            }
        },
        {
            "id":"PAYMENT_FAILED",
            "required_fields":[
                "SHOWED_PAYMENT_RESULT"
            ],
            "optional_fields":null,
            "rules":{
                "id":"DISTINCT",
                "value":{
                    "field_id":"PAYMENT_STATUS",
                    "type":"string",
                    "value":"approved"
                }
            }
        }
    ]
}

{
    "operation_type":"charge",
    "steps":[
        {
            "id":"set_amount",
            "required_fields":[
                "amount"
            ],
            "optional_fields":[
                "cart",
                "description"
            ],
            "rules":null
        },
        {
            "id":"set_charge_method",
            "required_fields":[
                "charge_method"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"set_card_type",
            "required_fields":[
                "card_type"
            ],
            "optional_fields":[
                "installments"
            ],
            "rules":null
        },
        {
            "id":"set_installments",
            "required_fields":[
                "installments"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"pairing",
            "required_fields":[
                "poi",
                "poi_type"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"get_working_key",
            "required_fields":[
                "working_key"
            ],
            "optional_fields":null,
            "rules":{
                "id":"equals",
                "value":{
                    "field_id":"poi_type",
                    "type":"string",
                    "value":"newland"
                }
            }
        },
        {
            "id":"read_card",
            "required_fields":[
                "card_data"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"tokenize_card",
            "required_fields":[
                "card_token",
                "payment_method"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"select_payment_method",
            "required_fields":[
                "payment_method"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"set_cvv",
            "required_fields":[
                "cvv"
            ],
            "optional_fields":null,
            "rules":{
                "type":"and",
                "value":[
                    {
                        "id":"or",
                        "value":[
                            {
                                "id":"equals",
                                "value":{
                                    "value":"chip",
                                    "field_id":"card_data_entry_mode",
                                    "type":"string"
                                }
                            },
                            {
                                "id":"equals",
                                "value":{
                                    "value":"amex",
                                    "field_id":"payment_method_id",
                                    "type":"string"
                                }
                            }
                        ]
                    },
                    {
                        "id":"equals",
                        "value":{
                            "value":true,
                            "field_id":"on_site_allowed",
                            "type":"bool"
                        }
                    }
                ]
            }
        },
        {
            "id":"post_payment",
            "required_fields":[
                "cvv",
                "payment"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"emv_finish_transaction",
            "required_fields":[
                "sent_advice",
                "was_reversed"
            ],
            "optional_fields":null,
            "rules":{
                "id":"and",
                "value":[
                    {
                        "id":"equals",
                        "value":{
                            "value":"chip",
                            "field_id":"card_data_entry_mode",
                            "type":"string"
                        }
                    },
                    {
                        "id":"equals",
                        "value":{
                            "value":false,
                            "field_id":"on_site_allowed",
                            "type":"bool"
                        }
                    }
                ]
            }
        },
        {
            "id":"sign",
            "required_fields":[
                "signature"
            ],
            "optional_fields":null,
            "rules":{
                "id":"and",
                "value":[
                    {
                        "id":"equals",
                        "value":{
                            "value":true,
                            "field_id":"signature_required",
                            "type":"bool"
                        }
                    },
                    {
                        "id":"equals",
                        "value":{
                            "value":"approved",
                            "field_id":"payment_status",
                            "type":"string"
                        }
                    }
                ]
            }
        },
        {
            "id":"post_notification",
            "required_fields":[
                "notification"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"congrats",
            "required_fields":[
                "showed_payment_result"
            ],
            "optional_fields":null,
            "rules":{
                "id":"equals",
                "value":{
                    "value":"approved",
                    "field_id":"payment_status",
                    "type":"string"
                }
            }
        },
        {
            "id":"payment_failed",
            "required_fields":[
                "showed_payment_result"
            ],
            "optional_fields":null,
            "rules":{
                "id":"distinct",
                "value":{
                    "value":"approved",
                    "field_id":"payment_status",
                    "type":"string"
                }
            }
        }
    ]
}

{
    "operation_type":"CHARGE",
    "steps":[
        {
            "id":"SET_AMOUNT",
            "required_fields":[
                "AMOUNT"
            ],
            "optional_fields":[
                "CART",
                "DESCRIPTION"
            ],
            "rules":null
        },
        {
            "id":"SET_CHARGE_METHOD",
            "required_fields":[
                "CHARGE_METHOD"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"SET_CARD_TYPE",
            "required_fields":[
                "CARD_TYPE"
            ],
            "optional_fields":[
                "INSTALLMENTS"
            ],
            "rules":null
        },
        {
            "id":"SET_INSTALLMENTS",
            "required_fields":[
                "INSTALLMENTS"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"PAIRING",
            "required_fields":[
                "POI",
                "POI_TYPE"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"GET_WORKING_KEY",
            "required_fields":[
                "WORKING_KEY"
            ],
            "optional_fields":null,
            "rules":{
                "id":"EQUALS",
                "value":{
                    "field_id":"POI_TYPE",
                    "type":"string",
                    "value":"NEWLAND"
                }
            }
        },
        {
            "id":"READ_CARD",
            "required_fields":[
                "CARD_DATA"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"TOKENIZE_CARD",
            "required_fields":[
                "CARD_TOKEN",
                "PAYMENT_METHOD"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"SELECT_PAYMENT_METHOD",
            "required_fields":[
                "PAYMENT_METHOD"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"SET_CVV",
            "required_fields":[
                "CVV"
            ],
            "optional_fields":null,
            "rules":{
                "type":"AND",
                "value":[
                    {
                        "id":"OR",
                        "value":[
                            {
                                "id":"EQUALS",
                                "value":{
                                    "value":"CHIP",
                                    "field_id":"CARD_DATA_ENTRY_MODE",
                                    "type":"string"
                                }
                            },
                            {
                                "id":"EQUALS",
                                "value":{
                                    "value":"amex",
                                    "field_id":"PAYMENT_METHOD_ID",
                                    "type":"string"
                                }
                            }
                        ]
                    },
                    {
                        "id":"EQUALS",
                        "value":{
                            "value":true,
                            "field_id":"ON_SITE_ALLOWED",
                            "type":"bool"
                        }
                    }
                ]
            }
        },
        {
            "id":"DO_PAYMENT",
            "required_fields":[
                "CVV",
                "PAYMENT"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"EMV_FINISH_TRANSACTION",
            "required_fields":[
                "SENT_ADVICE",
                "WAS_REVERSED"
            ],
            "optional_fields":null,
            "rules":{
                "id":"AND",
                "value":[
                    {
                        "id":"EQUALS",
                        "value":{
                            "value":"CHIP",
                            "field_id":"CARD_DATA_ENTRY_MODE",
                            "type":"string"
                        }
                    },
                    {
                        "id":"EQUALS",
                        "value":{
                            "value":false,
                            "field_id":"ON_SITE_ALLOWED",
                            "type":"bool"
                        }
                    }
                ]
            }
        },
        {
            "id":"SIGN",
            "required_fields":[
                "SIGNATURE"
            ],
            "optional_fields":null,
            "rules":{
                "id":"AND",
                "value":[
                    {
                        "id":"EQUALS",
                        "value":{
                            "value":true,
                            "field_id":"SIGNATURE_REQUIRED",
                            "type":"bool"
                        }
                    },
                    {
                        "id":"EQUALS",
                        "value":{
                            "value":"approved",
                            "field_id":"PAYMENT_STATUS",
                            "type":"string"
                        }
                    }
                ]
            }
        },
        {
            "id":"POST_NOTIFICATION",
            "required_fields":[
                "NOTIFICATION"
            ],
            "optional_fields":null,
            "rules":null
        },
        {
            "id":"CONGRATS",
            "required_fields":[
                "SHOWED_PAYMENT_RESULT"
            ],
            "optional_fields":null,
            "rules":{
                "id":"EQUALS",
                "value":{
                    "value":"approved",
                    "field_id":"PAYMENT_STATUS",
                    "type":"string"
                }
            }
        },
        {
            "id":"PAYMENT_FAILED",
            "required_fields":[
                "SHOWED_PAYMENT_RESULT"
            ],
            "optional_fields":null,
            "rules":{
                "id":"DISTINCT",
                "value":{
                    "value":"approved",
                    "field_id":"PAYMENT_STATUS",
                    "type":"string"
                }
            }
        }
    ]
}
